var expect = require('chai').expect;
var db = require('../db');

describe('db', function() {
  describe('isEmpty', function() {
    it('is true when database is empty', function() {
      expect(db.isEmpty()).to.be.true;
    });

    context('when db is not empty', function() {
      beforeEach(function() {
        db.index('lol');
      });

      it('is false', function() {
        expect(db.isEmpty()).to.be.false;
      });
    });
  });

  describe('search', function() {
    before(function() {
      db.index('anna');
      db.index('annabelle');
      db.index('austin');
      db.index('bettany');
      db.index('berta');
    });

    it('returns nothing with no search term', function() {
      expect(db.search('')).to.be.empty;
    });

    it ('searches by the search term', function() {
      expect(db.search('a')).to.have.members(['anna', 'annabelle', 'austin']);
      expect(db.search('an')).to.have.members(['anna', 'annabelle']);
      expect(db.search('be')).to.have.members(['bettany', 'berta']);
      expect(db.search('b')).to.have.members(['bettany', 'berta']);
      expect(db.search('berta')).to.have.members(['berta']);
    });

    it('limits the results', function() {
      expect(db.search('a', 2)).to.have.length(2);
    });

    context('search phrases', function() {
      before(function() {
        db.index('I think, John and Chris are going shopping today');
        db.index('No, Chris is going to watch a movie with Carl');
        db.index('And John is going to stay at home tonight');
      });

      it('searches phrases', function() {
        expect(db.search('go')).to.have.members([
          'I think, John and Chris are going shopping today',
          'No, Chris is going to watch a movie with Carl',
          'And John is going to stay at home tonight'
        ]);

        expect(db.search('jo')).to.have.members([
          'I think, John and Chris are going shopping today',
          'And John is going to stay at home tonight'
        ]);

        expect(db.search('c')).to.have.members([
          'I think, John and Chris are going shopping today',
          'No, Chris is going to watch a movie with Carl',
        ]);
      });
    });
  });
});